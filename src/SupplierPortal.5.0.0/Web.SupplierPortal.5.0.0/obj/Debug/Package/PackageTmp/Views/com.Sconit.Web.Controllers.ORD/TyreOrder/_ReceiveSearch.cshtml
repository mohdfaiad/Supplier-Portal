@using com.Sconit.Web.Models.SearchModels.ORD
<fieldset>
    @using (Html.BeginForm("ReceiveList", "TyreOrder"))
    {   
        <div class="search">
        <div class="search-label">
                <label for="OrderMaster_DateFrom">
                    生产单完工日期 从
                </label>
            </div>
            <div class="search-field">
                @(Html.Telerik().DateTimePicker()
            .Format(com.Sconit.Entity.BusinessConstants.LONG_DATE_FORMAT)
        .Name("CompleteDateFrom")
 .Value(TempData["TyreOrderSearchModel"] != null ? ((TyreOrderSearchModel)TempData["TyreOrderSearchModel"]).CompleteDateFrom : null)
                .HtmlAttributes(new { style = "margin-bottom: 1.3em;width:200px" }))
            </div>
            <div class="search-label">
                <label for="OrderMaster_DateTo">
                    至
                </label>
            </div>
            <div class="search-field">
                @(Html.Telerik().DateTimePicker()
        .Format(com.Sconit.Entity.BusinessConstants.LONG_DATE_FORMAT)
        .Name("CompleteDateTo")
         .Value(TempData["TyreOrderSearchModel"] != null ? ((TyreOrderSearchModel)TempData["TyreOrderSearchModel"]).CompleteDateTo : null)
                .HtmlAttributes(new { style = "margin-bottom: 1.3em;width:200px" }))
            </div>
        <div class="editor-label-2">
                <label for="MiscOrderMstr_Location">
                     @Resources.ORD.OrderMaster.OrderMaster_Flow_Production
                </label>
            </div>
            <div class="editor-field-2">
              @Html.TextArea("ProdLines", TempData["TyreOrderSearchModel"] != null ? ((TyreOrderSearchModel)TempData["TyreOrderSearchModel"]).ProdLines : string.Empty, new { rows = 2, style = "min-height:0;width:50%" })
            </div>
             <div class="search-label">
                <label for="OrderMaster_OrderNo">
                </label>
            </div>
            <div class="search-field">
            <button type="submit" id="btnSearch">
                @Resources.Global.Button_Search</button>
            <button type="button" id="btnReceive" style="display:none" onclick="ReceiveClick()" >
                结算</button>
            </div>
            
           
        </div>
        <div class="search-footer">
            
        </div>

    }
</fieldset>
<script type="text/javascript">
    function ReceiveClick() {
        if ($("#checkAll").attr("checked")) {
            var data = {
                ProdLines: $('#ProdLines').val(),
                CompleteDateFrom: $('#CompleteDateFrom').val(),
                CompleteDateTo: $('#CompleteDateTo').val()
            };
            if ($('#CompleteDateFrom').val() == "" || $('#CompleteDateTo').val() == "") {
                $message.error("全选结算，请填写完工日期。");
                return;
            }
            $.ajax({
                type: "Post",
                dataType: "html",
                url: "@Url.Content("~/TyreOrder/TyreReceive/")",
                data: data,
                cache: false,
                success: function (data, textStatus) {
                    var $tGrid = $("#content");
                    $($tGrid).html(data);
                }
            });
        } else {
            var $checkRecords = $("input[name='checkedRecords']");
            var checkIds = "";
            for (var i = 0; i < $checkRecords.length; i++) {
                if ($checkRecords[i].checked) {
                    if (checkIds == "") {
                        checkIds = "'" + $checkRecords[i].value + "'";
                    } else {
                        checkIds += ",'" + $checkRecords[i].value + "'";
                    }
                }
            }

            if (checkIds == "") {
                $message.error("请选择要结算的明细。");
                return;
            }
            var data = {
                ids: checkIds,
                ProdLines: $('#ProdLines').val(),
                CompleteDateFrom: $('#CompleteDateFrom').val(),
                CompleteDateTo: $('#CompleteDateTo').val()
            };
            $.ajax({
                type: "Post",
                dataType: "html",
                url: "@Url.Content("~/TyreOrder/TyreReceive/")",
                data: data,
                cache: false,
                success: function (data, textStatus) {
                    var $tGrid = $("#content");
                    $($tGrid).html(data);
                }
            });
        }
    }
</script>
